# Milestone v1.0: Multilingual Support (i18n)

**Status:** SHIPPED 2026-01-26
**Phases:** 1-4
**Total Plans:** 7

## Overview

This milestone adds full multilingual support to CAAL, enabling French-speaking users to interact entirely in their language. The journey starts with infrastructure (global language setting), flows through UI localization (frontend and mobile in parallel), and completes with voice pipeline integration (STT language parameter, TTS voice mapping, localized prompts). Each phase delivers a coherent, testable capability.

## Phases

### Phase 1: Foundation
**Goal**: Users can configure their preferred language, and that setting is available to all CAAL components
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 01-01-PLAN.md - Add global language setting to backend, frontend, and mobile

**Details:**
- Global `language` field in DEFAULT_SETTINGS with ISO 639-1 codes (en, fr)
- Language field in SetupCompleteRequest (optional for backward compat)
- Frontend Settings interface with language property
- Mobile _language state field
- Requirements: INFRA-01, INFRA-02, INFRA-03

### Phase 2: Frontend i18n
**Goal**: Users can interact with the web UI entirely in their configured language
**Depends on**: Phase 1 (needs language setting to read)
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md - next-intl infrastructure setup (install, config, provider)
- [x] 02-02-PLAN.md - EN/FR message files and UI localization

**Details:**
- next-intl with App Router integration
- Cookie-based locale detection (CAAL_LOCALE)
- NextIntlClientProvider in root layout
- Complete EN/FR message files (128 keys each)
- Localized settings panel with language selector dropdown
- Localized welcome view and setup wizard
- Requirements: FRONT-01 through FRONT-06

### Phase 3: Mobile i18n
**Goal**: Users can interact with the mobile app entirely in their configured language
**Depends on**: Phase 1 (needs language setting to read)
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md - Flutter intl infrastructure (l10n config, ARB files, LocaleProvider)
- [x] 03-02-PLAN.md - Screen localization and language selector

**Details:**
- Flutter l10n infrastructure with code generation
- EN/FR ARB translation files (84 keys)
- LocaleProvider for runtime locale management with backend sync
- All screens localized (welcome, setup, settings, agent)
- Language selector in settings with backend sync
- Requirements: MOBILE-01 through MOBILE-05

### Phase 4: Voice Pipeline
**Goal**: Users can have full voice conversations in their configured language
**Depends on**: Phase 1 (needs language setting), Phases 2-3 optional (UI to change setting)
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md - Localized prompts (EN/FR) and French date/time formatting
- [x] 04-02-PLAN.md - STT language param, TTS voice mapping, wake greetings wiring

**Details:**
- Per-language system prompts (prompt/en/default.md, prompt/fr/default.md)
- French date/time formatting (cardinal numbers, 24h format)
- Language-aware STT with Whisper language parameter
- Per-language Piper voice selection (PIPER_VOICE_MAP)
- Auto-switch from Kokoro to Piper for non-English languages
- Per-language wake greetings with user override support
- Requirements: VOICE-01 through VOICE-05

---

## Milestone Summary

**Key Decisions:**
- Global language setting (single setting controls all components)
- Cookie-based locale (CAAL_LOCALE) instead of URL routing for Next.js
- English messages as base with locale overlay for fallback
- Technical terms stay in English (Ollama, Groq, Kokoro, Piper, etc.)
- Per-language prompt dirs: prompt/{lang}/default.md with fallback
- Custom prompts remain language-neutral (prompt/custom.md always wins)
- PIPER_VOICE_MAP dict in voice_agent.py (not in settings) to keep mapping close to usage
- Auto-switch from Kokoro to Piper for non-English languages with log warning
- French prompt uses informal tu/toi register
- French dates use cardinal numbers except "premier" for 1st

**Issues Resolved:**
- Wake greetings not using per-language defaults when user hasn't customized
- Groq/Llama malformed tool call syntax causing 400 errors
- Silent session after tool execution (model attempting second tool call in stream)

**Issues Deferred:**
- DuckDuckGo web search returns poor quality results for French queries (search implementation quality, not i18n)

**Technical Debt Incurred:**
- None. Minor pre-existing linter warnings (E501, E402) not introduced by this milestone.

---

_For current project status, see .planning/ROADMAP.md_
